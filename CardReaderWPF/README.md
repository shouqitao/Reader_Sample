# CardReader WPF 项目

## 项目概述

这是一个基于 CardReaderLib 类库的 WPF 读卡器示例程序，提供了现代化的用户界面和完整的读卡器功能。该程序展示了如何使用 CardReaderLib 类库实现各种读卡功能。

## 🏗️ 项目结构

```
CardReader.sln                    # 解决方案文件
├── CardReaderLib/                # 读卡器类库
│   ├── Models/                   # 数据模型
│   ├── Core/                     # 核心API封装
│   ├── Exceptions/               # 异常处理
│   └── Examples/                 # 使用示例
├── CardReaderWPF/                # WPF应用程序
│   ├── Properties/               # 程序集配置
│   ├── MainWindow.xaml           # 主窗口界面
│   ├── MainWindow.xaml.cs        # 主窗口逻辑
│   ├── App.xaml                  # 应用程序配置
│   └── App.config                # 配置文件
└── Reader_Sample/                # 原始WinForms示例
```

## ✨ 功能特性

### 📱 现代化界面
- **响应式布局** - 适应不同屏幕尺寸
- **Material Design风格** - 现代化的视觉设计
- **实时状态反馈** - 操作状态和进度提示
- **图标化按钮** - 直观的功能识别

### 🔌 设备连接
- **多种连接方式** - 支持USB和串口连接
- **连接状态监控** - 实时显示连接状态
- **自动重连机制** - 连接失败时的重试逻辑

### 🪪 读卡功能
- **身份证读取** - 支持华大和通用API
- **银行卡读取** - 接触式和非接触式
- **社保卡读取** - 医保社保信息
- **M1卡读取** - Mifare One卡片
- **磁条卡读取** - 磁条银行卡刷取
- **二维码扫描** - 支持各种二维码格式
- **自动识别** - 智能识别卡片类型

### 🎯 用户体验
- **异步操作** - 避免界面冻结
- **进度指示器** - 操作进度可视化
- **详细日志** - 完整的操作记录
- **错误处理** - 友好的错误提示

## 🚀 快速开始

### 环境要求

- **Windows 操作系统** (Windows 7 或更高版本)
- **.NET Framework 4.8** 或更高版本
- **Visual Studio 2017** 或更高版本
- **读卡器设备** 及相应驱动程序

### 编译步骤

1. **打开解决方案**
   ```bash
   # 使用Visual Studio打开
   CardReader.sln
   ```

2. **设置平台**
   - 确保选择 `x86` 平台
   - 设置为 `Debug` 或 `Release` 配置

3. **编译项目**
   ```bash
   # 使用MSBuild命令行编译
   msbuild CardReader.sln /p:Configuration=Debug /p:Platform=x86
   ```

### 运行程序

1. **准备环境**
   - 确保读卡器驱动已安装
   - 将必要的DLL文件复制到输出目录
   - 连接读卡器设备

2. **启动程序**
   ```bash
   # 运行WPF程序
   .\CardReaderWPF\bin\Debug\CardReaderWPF.exe
   ```

## 📖 使用指南

### 设备连接

1. **选择连接方式**
   - USB连接（推荐）
   - 串口连接

2. **点击连接设备**
   - 程序会自动检测设备
   - 连接成功后按钮变为"断开连接"

### 读取身份证

1. **放置身份证**
   - 将身份证放在读卡器感应区
   
2. **选择读取方式**
   - 点击"读取身份证"（通用API）
   - 或点击"读取身份证(华大)"（华大API）

3. **查看结果**
   - 身份证信息显示在右侧
   - 照片显示在左侧

### 读取银行卡

1. **选择读取方式**
   - "接触式银行卡" - 插入卡片
   - "非接触银行卡" - 靠近感应区

2. **查看卡号**
   - 银行卡号显示在专用文本框
   - 详细信息显示在右侧

### 自动识别模式

1. **启动自动识别**
   - 点击"自动识别读卡"按钮
   - 程序进入连续监听模式

2. **放置任意卡片**
   - 程序自动识别卡片类型
   - 显示相应的卡片信息

3. **停止识别**
   - 点击"停止自动识别"按钮

## ⚙️ 配置说明

### App.config 配置项

```xml
<appSettings>
    <!-- 读卡器配置 -->
    <add key="UseUsb" value="true" />           <!-- 使用USB连接 -->
    <add key="UsbPort" value="1001" />          <!-- USB端口号 -->
    <add key="SerialPort" value="1" />          <!-- 串口号 -->
    <add key="TimeoutSeconds" value="10" />     <!-- 超时时间 -->
    <add key="AutoBeep" value="true" />         <!-- 自动蜂鸣 -->
    <add key="PhotoSavePath" value="Photos" />  <!-- 照片保存路径 -->
</appSettings>
```

### 照片保存

- 身份证照片自动保存到 `Photos` 目录
- 文件名格式：`id_photo_yyyyMMddHHmmss.bmp`
- 可在配置文件中修改保存路径

## 🔧 故障排查

### 常见问题

**Q: 设备连接失败**
- 检查读卡器设备是否正常连接
- 确认驱动程序已正确安装
- 尝试不同的连接方式和端口

**Q: 读卡失败**
- 确保卡片放置正确
- 检查卡片是否损坏
- 增加超时时间设置

**Q: 程序启动异常**
- 确保使用x86平台编译
- 检查.NET Framework版本
- 确认所有依赖文件存在

### 调试信息

程序提供详细的日志信息：
- 操作日志显示在底部日志区域
- 错误信息会标记❌符号
- 可通过"清空日志"按钮清理日志

## 📚 技术架构

### 核心组件

1. **CardReaderLib** - 读卡器核心类库
   - 封装硬件API调用
   - 提供统一的编程接口
   - 处理异常和错误

2. **CardReaderWPF** - WPF用户界面
   - MVVM架构模式
   - 异步操作处理
   - 响应式界面设计

3. **配置管理** - 灵活的配置系统
   - App.config配置文件
   - 运行时配置修改
   - 用户偏好设置

### 关键技术

- **P/Invoke** - 调用本机DLL
- **异步编程** - Task/await模式
- **WPF数据绑定** - 界面与数据分离
- **异常处理** - 完善的错误处理机制

## 🔄 版本信息

- **当前版本**: v1.0.0
- **发布日期**: 2024年
- **兼容性**: .NET Framework 4.8, Windows 7+

## 📄 许可证

本项目采用开源许可证，允许自由使用、修改和分发。

---

## 💡 开发建议

1. **扩展功能** - 可基于CardReaderLib添加更多读卡器支持
2. **界面优化** - 可进一步美化界面设计
3. **性能优化** - 可优化读卡速度和响应时间
4. **功能增强** - 可添加数据库存储、网络传输等功能

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进项目！